

##1、引言

随着互联网大数据时代的到来，越来越多的网站、应用系统都需要支撑大量甚至海量数据存储，同时还伴有高并发、高可用、高可扩展等特性要求。

很多时候，传统的关系型数据库在应付这些已经显得力不从心，并暴露了许多难以克服的问题。

由此，各种各样的 NoSQL（Not Only SQL）数据库作为传统关系型数据的一个有力补充得到迅猛发展。

本文将分析传统数据库（即SQL数据库）存在的一些问题，以及盘点目前市面上几大类 NoSQL 特性、优缺点等，希望给大家提供一些在不同业务场景下存储技术选型方面的参考。

**即时通讯网站长点评：**作为专业分享即时通讯开发知识的社区来说，很多IM开发者在进行架构设计和选型的第一时间想到的，就是该如何选择数据库，MySQL？Oracle？SQL Server？或者NoSQL？这显然没有标准答案，因为每个产品、每套系统、每个架构都有自身的用户规模、适应场景、成本因素等等考量。本文可能无法给予同为即时通讯开发者的你一个确切答案，但当你在读完本文，对市面上主要数据库（包括NoSQL数据库）的技术特性、适用场景、优缺点都有了解之后，相信你完全能够根据自已产品或系统的特点，找到适合你的数据库方案，这也正是本文的意义所在。

![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_u=3846051135,214348580&amp;fm=26&amp;gp=0.jpg](http://www.52im.net/data/attachment/forum/201909/25/213905fl4oq3sqqoz4q3hf.jpg)
2、关于作者
**陈彩华（caison）：**主要从事服务端开发、需求分析、系统设计、优化重构工作，主要开发语言是 Java，现任广州贝聊服务端研发工程师。

**陈彩华还分享过另几篇技术文章，如有兴趣可一并阅读：**

《[新手入门：目前为止最透彻的的Netty高性能原理和框架架构解析](http://www.52im.net/thread-2043-1-1.html)》《[高性能网络编程(五)：一文读懂高性能网络编程中的I/O模型](http://www.52im.net/thread-1935-1-1.html)》《[高性能网络编程(六)：一文读懂高性能网络编程中的线程模型](http://www.52im.net/thread-1939-1-1.html)》

3、系列文章
**▼ IM开发干货系列文章（本文是其第18篇）：**

《[IM消息送达保证机制实现(一)：保证在线实时消息的可靠投递](http://www.52im.net/thread-294-1-1.html)》《[IM消息送达保证机制实现(二)：保证离线消息的可靠投递](http://www.52im.net/thread-594-1-1.html)》《[如何保证IM实时消息的“时序性”与“一致性”？](http://www.52im.net/thread-714-1-1.html)》《[IM单聊和群聊中的在线状态同步应该用“推”还是“拉”？](http://www.52im.net/thread-715-1-1.html)》《[IM群聊消息如此复杂，如何保证不丢不重？](http://www.52im.net/thread-753-1-1.html)》《[一种Android端IM智能心跳算法的设计与实现探讨（含样例代码）](http://www.52im.net/thread-783-1-1.html)》《[移动端IM登录时拉取数据如何作到省流量？](http://www.52im.net/thread-787-1-1.html)》《[通俗易懂：基于集群的移动端IM接入层负载均衡方案分享](http://www.52im.net/thread-802-1-1.html)》《[浅谈移动端IM的多点登陆和消息漫游原理](http://www.52im.net/thread-867-1-1.html)》《[IM开发基础知识补课(一)：正确理解前置HTTP SSO单点登陆接口的原理](http://www.52im.net/thread-1351-1-1.html)》《[IM开发基础知识补课(二)：如何设计大量图片文件的服务端存储架构？](http://www.52im.net/thread-1356-1-1.html)》《[IM开发基础知识补课(三)：快速理解服务端数据库读写分离原理及实践建议](http://www.52im.net/thread-1366-1-1.html)》《[IM开发基础知识补课(四)：正确理解HTTP短连接中的Cookie、Session和Token](http://www.52im.net/thread-1525-1-1.html)》《[IM群聊消息的已读回执功能该怎么实现？](http://www.52im.net/thread-1611-1-1.html)》《[IM群聊消息究竟是存1份(即扩散读)还是存多份(即扩散写)？](http://www.52im.net/thread-1616-1-1.html)》《[IM开发基础知识补课(五)：通俗易懂，正确理解并用好MQ消息队列](http://www.52im.net/thread-1979-1-1.html)》《[一个低成本确保IM消息时序的方法探讨](http://www.52im.net/thread-866-1-1.html)》《[IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！](http://www.52im.net/thread-2759-1-1.html)》（本文）《[IM里“附近的人”功能实现原理是什么？如何高效率地实现它？](http://www.52im.net/thread-2827-1-1.html)》《[IM开发基础知识补课(七)：主流移动端账号登录方式的原理及设计思路](http://www.52im.net/thread-2863-1-1.html)》《[IM开发基础知识补课(八)：史上最通俗，彻底搞懂字符乱码问题的本质](http://www.52im.net/thread-2868-1-1.html)》《[IM的扫码登功能如何实现？一文搞懂主流应用的扫码登陆技术原理](http://www.52im.net/thread-2892-1-1.html)》《[IM要做手机扫码登陆？先看看微信的扫码登录功能技术原理](http://www.52im.net/thread-2941-1-1.html)》《[IM开发基础知识补课(九)：想开发IM集群？先搞懂什么是RPC！](http://www.52im.net/thread-2996-1-1.html)》《[IM开发实战干货：我是如何解决大量离线聊天消息导致客户端卡顿的](http://www.52im.net/thread-3036-1-1.html)》《[IM开发干货分享：如何优雅的实现大量离线消息的可靠投递](http://www.52im.net/thread-3069-1-1.html)》《[IM开发基础知识补课(十)：大型IM系统有多难？万字长文，搞懂异地多活！](http://www.52im.net/thread-3742-1-1.html)》

如果您是IM开发初学者，强烈建议首先阅读《[新手入门一篇就够：从零开发移动端IM](http://www.52im.net/thread-464-1-1.html)》。
4、传统SQL数据库的缺点
传统的关系数据库有如下几个缺点。

**\*1）大数据场景下 I/O 较高：***因为数据是按行存储，即使只针对其中某一列进行运算，关系型数据库也会将整行数据从存储设备中读入内存，导致 I/O 较高。

**\*2）存储的是行记录：***无法存储数据结构。

**\*3）表结构 Schema 扩展不方便：***如要修改表结构，需要执行 DDL(data definition language)，语句修改，修改期间会导致锁表，部分服务不可用。

**\*4）全文搜索功能较弱：***关系型数据库下只能够进行子字符串的匹配查询，当表的数据逐渐变大的时候，like 查询的匹配会非常慢，即使在有索引的情况下。况且关系型数据库也不应该对文本字段进行索引。

**\*5）存储和处理复杂关系型数据功能较弱：***许多应用程序需要了解和导航高度连接数据之间的关系，才能启用社交应用程序、推荐引擎、欺诈检测、知识图谱、生命科学和 IT/网络等用例。然而传统的关系数据库并不善于处理数据点之间的关系。它们的表格数据模型和严格的模式使它们很难添加新的或不同种类的关联信息。
5、NoSQL 解决方案
NoSQL（Not Only SQL），泛指非关系型的数据库，可以理解为 SQL 的一个有力补充。

在 NoSQL 许多方面性能大大优于非关系型数据库的同时，往往也伴随一些特性的缺失，比较常见的是事务库事务功能的缺失。

**数据库事务正确执行的四个基本要素 ACID 如下：**
![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_1.jpg](http://www.52im.net/data/attachment/forum/201909/26/112753h3o7990toz7nykuu.jpg)

下面将分别介绍 5 大类 NoSQL 数据库的技术特性，以及针对传统关系型数据库的缺点。
6、列式数据库
列式数据库是以列相关存储架构进行数据存储的数据库，主要适合于批量数据处理和即时查询。

相对应的是行式数据库，数据以行相关的存储体系架构进行空间分配，主要适合于小批量的数据处理，常用于联机事务型数据处理。

基于列式数据库的列列存储特性，可以解决某些特定场景下关系型数据库 I/O 较高的问题。

6.1基本原理
传统关系型数据库是按照行来存储数据库，称为“行式数据库”，而列式数据库是按照列来存储数据。

将表放入存储系统中有两种方法，而我们绝大部分是采用行存储的。行存储法是将各行放入连续的物理位置，这很像传统的记录和文件系统。

列存储法是将数据按照列存储到数据库中，与行存储类似。

**下图是两种存储方法的图形化解释：**
![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_2.jpg](http://www.52im.net/data/attachment/forum/201909/26/113215p64sl4lial1187fi.jpg)

6.2常见列式数据库
![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_3.png](http://www.52im.net/data/attachment/forum/201909/26/113233raxf7m6z7xm79zy7.png)
**HBase：**是一个开源的非关系型分布式数据库（NoSQL），它参考了谷歌的 BigTable 建模，实现的编程语言为 Java。

它是 Apache 软件基金会的 Hadoop 项目的一部分，运行于 HDFS 文件系统之上，为 Hadoop 提供类似于 BigTable 规模的服务。因此，它可以容错地存储海量稀疏的数据。

![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_4.jpg](http://www.52im.net/data/attachment/forum/201909/26/113306tlhiiaagi9ipairv.jpg)
**BigTable：**是一种压缩的、高性能的、高可扩展性的，基于 Google 文件系统（Google File System，GFS）的数据存储系统，用于存储大规模结构化数据，适用于云端计算。

6.3相关特性
**1）优点如下：**

高效的储存空间利用率：列式数据库由于其针对不同列的数据特征而发明的不同算法使其往往有比行式数据库高的多的压缩率。

普通的行式数据库一般压缩率在 3：1  到 5：1  左右，而列式数据库的压缩率一般在 8：1 到 30：1  左右。

比较常见的，通过字典表压缩数据： 下面中才是那张表本来的样子。经过字典表进行数据压缩后，表中的字符串才都变成数字了。

正因为每个字符串在字典表里只出现一次了，所以达到了压缩的目的(有点像规范化和非规范化 Normalize 和 Denomalize)。

![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_5.jpg](http://www.52im.net/data/attachment/forum/201909/26/113410ea4fncmfdztmo4ef.jpg)

查询效率高：读取多条数据的同一列效率高，因为这些列都是存储在一起的，一次磁盘操作可以把数据的指定列全部读取到内存中。

下图通过一条查询的执行过程说明列式存储(以及数据压缩)的优点：
![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_6.jpg](http://www.52im.net/data/attachment/forum/201909/26/113529e3ootwqzw1qi92qz.jpg)

执行步骤如下：

a. 去字典表里找到字符串对应数字(只进行一次字符串比较)；b. 用数字去列表里匹配，匹配上的位置设为 1。；c. 把不同列的匹配结果进行位运算得到符合所有条件的记录下标；d. 使用这个下标组装出最终的结果集。

列式数据库还适合做聚合操作，适合大量的数据而不是小数据。

**2）缺点如下：**

不适合扫描小量数据；不适合随机的更新；不适合做含有删除和更新的实时操作；单行的数据是 ACID 的，多行的事务时，不支持事务的正常回滚，支持 I(Isolation)隔离性(事务串行提交)，D(Durability)持久性，不能保证 A(Atomicity)原子性， C(Consistency)一致性。

6.3使用场景
**以 HBase 为例说明：**

1）大数据量（100s TB级数据），且有快速随机访问的需求；2）写密集型应用，每天写入量巨大，而相对读数量较小的应用，比如 IM 的历史消息，游戏的日志等等；3）不需要复杂查询条件来查询数据的应用，HBase 只支持基于 rowkey 的查询，对于 HBase 来说，单条记录或者小范围的查询是可以接受的。大范围的查询由于分布式的原因，可能在性能上有点影响，HBase 不适用于有 join，多级索引，表关系复杂的数据模型；4）对性能和可靠性要求非常高的应用，由于 HBase 本身没有单点故障，可用性非常高；5）数据量较大而且增长量无法预估的应用，需要进行优雅的数据扩展的 HBase 支持在线扩展，即使在一段时间内数据量呈井喷式增长，也可以通过 HBase 横向扩展来满足功能；6）存储结构化和半结构化的数据。

7、K-V 数据库
指的是使用键值(key-value)存储的数据库，其数据按照键值对的形式进行组织、索引和存储。

K-V 存储非常适合不涉及过多数据关系业务关系的数据，同时能有效减少读写磁盘的次数，比 SQL 数据库存储拥有更好的读写性能，能够解决关系型数据库无法存储数据结构的问题。

7.1常见 K-V 数据库
![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_7.png](http://www.52im.net/data/attachment/forum/201909/26/114051meqd2ttqn7qbqsq9.png)
**Redis：**是一个使用 ANSI C 编写的开源、支持网络、基于内存、可选持久性的键值对存储数据库。

从 2015 年 6 月开始，Redis 的开发由 Redis Labs 赞助，而 2013 年 5 月至 2015 年 6 月期间，其开发由 Pivotal 赞助。

在 2013 年 5 月之前，其开发由 VMware 赞助。根据月度排行网站 DB-Engines.com 的数据显示，Redis 是最流行的键值对存储数据库。

![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_8.jpg](http://www.52im.net/data/attachment/forum/201909/26/114117tqob0qzeqbdqqyqz.jpg)
**Cassandra：**Apache Cassandra（社区内一般简称为C*）是一套开源分布式 NoSQL 数据库系统。

它最初由 Facebook 开发，用于储存收件箱等简单格式数据，集 Google BigTable 的数据模型与 Amazon Dynamo 的完全分布式架构于一身。

Facebook 于 2008 将 Cassandra 开源，此后，由于 Cassandra 良好的可扩展性和性能。

它被 Apple，Comcas，Instagram，Spotify，eBay，Rackspace，Netflix 等知名网站所采用，成为了一种流行的分布式结构化数据存储方案。

![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_9.jpg](http://www.52im.net/data/attachment/forum/201909/26/114137bpa4eakxlkw5alia.jpg)
**LevelDB：**是一个由 Google 公司所研发的键／值对（Key/Value Pair）嵌入式数据库管理系统编程库， 以开源的 BSD 许可证发布。

7.2相关特性
**以 Redis 为例，K-V 数据库优点如下：**

1）性能极高：Redis 能支持超过 10W 的 TPS；2）丰富的数据类型：Redis 支持包括 String，Hash，List，Set，Sorted Set，Bitmap 和 Hyperloglog；3）丰富的特性：Redis 还支持 publish/subscribe，通知，key 过期等等特性。

**缺点如下：**

针对 ACID，Redis 事务不能支持原子性和持久性(A 和 D)，只支持隔离性和一致性(I 和 C) 。

**特别说明一下：**这里所说的无法保证原子性，是针对 Redis 的事务操作，因为事务是不支持回滚（roll back），而因为 Redis 的单线程模型，Redis 的普通操作是原子性的。

大部分业务不需要严格遵循 ACID 原则，例如游戏实时排行榜，粉丝关注等场景，即使部分数据持久化失败，其实业务影响也非常小。因此在设计方案时，需要根据业务特征和要求来做选择。

7.3使用场景
**适用场景：**

储存用户信息(比如会话)、配置文件、参数、购物车等等。这些信息一般都和 ID（键）挂钩。

**不适用场景：**

1）需要通过值来查询，而不是键来查询：Key-Value 数据库中根本没有通过值查询的途径；2）需要储存数据之间的关系：在 Key-Value 数据库中不能通过两个或以上的键来关联数据；3）需要事务的支持：在 Key-Value 数据库中故障产生时不可以进行回滚。

8、文档数据库
文档数据库（也称为文档型数据库）是旨在将半结构化数据存储为文档的一种数据库。文档数据库通常以 JSON 或 XML 格式存储数据。

由于文档数据库的 no-schema 特性，可以存储和读取任意数据。

由于使用的数据格式是 JSON 或者 BSON，因为 JSON 数据是自描述的，无需在使用前定义字段，读取一个 JSON 中不存在的字段也不会导致 SQL 那样的语法错误，可以解决关系型数据库表结构 Schema 扩展不方便的问题。

8.1常见文档数据库
![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_10.jpg](http://www.52im.net/data/attachment/forum/201909/26/121649lu3rws8ndooz883d.jpg)
**MongoDB：**是一种面向文档的数据库管理系统，由 C++ 撰写而成，以此来解决应用程序开发社区中的大量现实问题。2007 年 10 月，MongoDB 由 10gen 团队所发展。2009 年 2 月首度推出。

![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_11.jpg](http://www.52im.net/data/attachment/forum/201909/26/114545v8nhrdb2edcihg97.jpg)
**CouchDB：**Apache CouchDB 是一个开源数据库，专注于易用性和成为"完全拥抱 Web 的数据库"。

它是一个使用 JSON 作为存储格式，JavaScript 作为查询语言，MapReduce 和 HTTP 作为 API 的 NoSQL 数据库。

其中一个显著的功能就是多主复制。CouchDB 的第一个版本发布在 2005 年，在 2008 年成为了 Apache 的项目。

8.2相关特性
**以 MongoDB 为例进行说明，文档数据库优点如下：**

1）新增字段简单，无需像关系型数据库一样先执行 DDL 语句修改表结构，程序代码直接读写即可；2）容易兼容历史数据，对于历史数据，即使没有新增的字段，也不会导致错误，只会返回空值，此时代码兼容处理即可；3）容易存储复杂数据，JSON 是一种强大的描述语言，能够描述复杂的数据结构。

**相比传统关系型数据库，文档数据库的缺点主要是对多条数据记录的事务支持较弱，具体体现如下：**

1）Atomicity(原子性)，仅支持单行/文档级原子性，不支持多行、多文档、多语句原子性；2）Solation(隔离性)，隔离级别仅支持已提交读（Read committed）级别，可能导致不可重复读，幻读的问题；3）不支持复杂查询，例如 join 查询，如果需要 join 查询，需要多次操作数据库。

MongonDB 还支持多文档事务的 Consistency(一致性)和 Durability(持久性)，虽然官方宣布 MongoDB 将在 4.0 版本中正式推出多文档 ACID 事务支持，最后落地情况还有待见证。

8.3使用场景
**适用场景：**

1）数据量很大或者未来会变得很大；2）表结构不明确，且字段在不断增加，例如内容管理系统，信息管理系统。

**不适用场景：**

1）在不同的文档上需要添加事务。Document-Oriented 数据库并不支持文档间的事务；2）多个文档之间需要复杂查询，例如 join。

9、全文搜索引擎
传统关系型数据库主要通过索引来达到快速查询的目的，在全文搜索的业务下，索引也无能为力。

**主要体现在：**

1）全文搜索的条件可以随意排列组合，如果通过索引来满足，则索引的数量非常多；2）全文搜索的模糊匹配方式，索引无法满足，只能用 like 查询，而 like 查询是整表扫描，效率非常低。

而全文搜索引擎的出现，正是解决关系型数据库全文搜索功能较弱的问题。

9.1基本原理
全文搜索引擎的技术原理称为“倒排索引”（inverted index），是一种索引方法，其基本原理是建立单词到文档的索引。与之相对的是“正排索引”，其基本原理是建立文档到单词的索引。

**现在有如下文档集合：**
![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_12.jpg](http://www.52im.net/data/attachment/forum/201909/26/114949zj5fxfn3tyn73m7y.jpg)

**正排索引得到索引如下：**
![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_13.jpg](http://www.52im.net/data/attachment/forum/201909/26/115002xdmx4qkkq9vddig1.jpg)

由上可见，正排索引适用于根据文档名称查询文档内容。

**简单的倒排索引如下：**
![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_14.jpg](http://www.52im.net/data/attachment/forum/201909/26/115015g1g52idrgnfgrkmk.jpg)

**带有单词频率信息的倒排索引如下：**
![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_15.jpg](http://www.52im.net/data/attachment/forum/201909/26/115025xhke7ks5zvw0fnfk.jpg)

由上可见，倒排索引适用于根据关键词来查询文档内容。

9.2常见全文搜索引擎
![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_16.jpg](http://www.52im.net/data/attachment/forum/201909/26/115044rzv1d7azv611d44x.jpg)
**Elastic search：**是一个基于 Lucene 的搜索引擎。它提供了一个分布式，多租户，能够全文搜索与发动机 HTTP Web 界面和无架构 JSON 文件。

Elastic search 是用 Java 开发的，并根据 Apache License 的条款作为开源发布。

根据 DB-Engines 排名，Elasticsearch 是最受欢迎的企业搜索引擎，后面是基于 Lucene 的 Apache Solr。

![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_17.jpg](http://www.52im.net/data/attachment/forum/201909/26/120047vrebqcxoseh4hsgp.jpg)
**Solr：**是 Apache Lucene 项目的开源企业搜索平台。其主要功能包括全文检索、命中标示、分面搜索、动态聚类、数据库集成，以及富文本（如 Word、PDF）的处理。Solr 是高度可扩展的，并提供了分布式搜索和索引复制。

9.3相关特性
**以 Elasticsearch 为例，全文搜索引擎优点如下：**

1）查询效率高，对海量数据进行近实时的处理；2）可扩展性，基于集群环境可以方便横向扩展，可以承载 PB 级数据；3）高可用，Elasticsearch 集群弹性，他们将发现新的或失败的节点，重组和重新平衡数据，确保数据是安全的和可访问的。

**缺点如下：**

1）ACID 支持不足，单一文档的数据是 ACID 的，包含多个文档的事务时不支持事务的正常回滚，支持 I(Isolation)隔离性（基于乐观锁机制的），D(Durability)持久性，不支持 A(Atomicity)原子性，C(Consistency)一致性；2）对类似数据库中通过外键的复杂的多表关联操作支持较弱；3）读写有一定延时，写入的数据，最快 1s 中能被检索到；4）更新性能较低，底层实现是先删数据，再插入新数据；5）内存占用大，因为 Lucene 将索引部分加载到内存中。

9.4使用场景
**适用场景如下：**

1）分布式的搜索引擎和数据分析引擎；2）全文检索，结构化检索，数据分析；3）对海量数据进行近实时的处理，可以将海量数据分散到多台服务器上去存储和检索。

**不适用场景如下：**

1）数据需要频繁更新；2）需要复杂关联查询。

10、图形数据库
![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_18.jpg](http://www.52im.net/data/attachment/forum/201909/26/120437gmtn87viki1i9nx9.jpg)

图形数据库应用图形理论存储实体之间的关系信息。最常见例子就是社会网络中人与人之间的关系。

关系型数据库用于存储“关系型”数据的效果并不好，其查询复杂、缓慢、超出预期。

而图形数据库的独特设计恰恰弥补了这个缺陷，解决关系型数据库存储和处理复杂关系型数据功能较弱的问题。

10.1常见图形数据库
![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_19.jpg](http://www.52im.net/data/attachment/forum/201909/26/121707hqnmabnmja2bb7qa.jpg)
**Neo4j：**是由 Neo4j，Inc. 开发的图形数据库管理系统。由其开发人员描述为具有原生图存储和处理的符合 ACID 的事务数据库，根据 DB-Engines 排名，Neo4j 是最流行的图形数据库。

![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_20.jpg](http://www.52im.net/data/attachment/forum/201909/26/120514j4ex02322x0ibenn.jpg)
**ArangoDB：**是由 triAGENS GmbH 开发的原生多模型数据库系统。数据库系统支持三个重要的数据模型（键/值，文档，图形），其中包含一个数据库核心和统一查询语言 AQL（ArangoDB 查询语言）。

查询语言是声明性的，允许在单个查询中组合不同的数据访问模式。ArangoDB 是一个 NoSQL 数据库系统，但 AQL 在很多方面与 SQL 类似。

![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_21.jpg](http://www.52im.net/data/attachment/forum/201909/26/120531xnw6no9a5p6vr4ps.jpg)
**Titan：**是一个可扩展的图形数据库，针对存储和查询包含分布在多机群集中的数百亿个顶点和边缘的图形进行了优化。

Titan 是一个事务性数据库，可以支持数千个并发用户实时执行复杂的图形遍历。

10.2相关特性
以 Neo4j 为例，Neo4j 使用数据结构中图（graph）的概念来进行建模。Neo4j 中两个最基本的概念是节点和边。

节点表示实体，边则表示实体之间的关系。节点和边都可以有自己的属性。不同实体通过各种不同的关系关联起来，形成复杂的对象图。

**针对关系数据，两种数据库的存储结构不同：**
![IM开发基础知识补课(六)：数据库用NoSQL还是SQL？读这篇就够了！_22.jpg](http://www.52im.net/data/attachment/forum/201909/26/121717vzb70rryk4rkmof7.jpg)

Neo4j 中，存储节点时使用了“index-free adjacency”，即每个节点都有指向其邻居节点的指针，可以让我们在 O(1) 的时间内找到邻居节点。

另外，按照官方的说法，在 Neo4j 中边是最重要的，即“first-class entities”，所以单独存储，这有利于在图遍历的时候提高速度，也可以很方便地以任何方向进行遍历。

**优点如下：**

1）高性能表现，图的遍历是图数据结构所具有的独特算法，即从一个节点开始，根据其连接的关系，可以快速和方便地找出它的邻近节点。
这种查找数据的方法并不受数据量的大小所影响，因为邻近查询始终查找的是有限的局部数据，不会对整个数据库进行搜索。2）设计的灵活性，数据结构的自然伸展特性及其非结构化的数据格式，让图数据库设计可以具有很大的伸缩性和灵活性。因为随着需求的变化而增加的节点、关系及其属性并不会影响到原来数据的正常使用。3）开发的敏捷性，直观明了的数据模型，从需求的讨论开始，到程序开发和实现，以及最终保存在数据库中的样子，它的模样似乎没有什么变化，甚至可以说本来就是一模一样的。4）完全支持 ACID，不像别的 NoSQL 数据库，Neo4j 还具有完全事务管理特性，完全支持 ACID 事务管理。

**缺点如下：**

1）具有支持节点，关系和属性的数量的限制；2）不支持拆分。

10.3使用场景
**适用场景如下：**

1）在一些关系性强的数据中，例如社交网络；2）推荐引擎。如果我们将数据以图的形式表现，那么将会非常有益于推荐的制定。

**不适用场景如下：**

1）记录大量基于事件的数据（例如日志条目或传感器数据）；2）对大规模分布式数据进行处理，类似于 Hadoop；3）适合于保存在关系型数据库中的结构化数据；4）二进制数据存储。

11、本文小结
**关系型数据库和 NoSQL 数据库的选型，往往需要考虑几个指标：**

1）数据量；2）并发量；3）实时性；4）一致性要求；5）读写分布和类型；6）安全性；7）运维成本。

**常见软件系统数据库选型参考如下：**

1）内部使用的管理型系统，如运营系统，数据量少，并发量小，首选考虑关系型；2）大流量系统，如电商单品页，后台考虑选关系型，前台考虑选内存型；3）日志型系统，原始数据考虑选列式，日志搜索考虑选倒排索引；4）搜索型系统，例如站内搜索，非通用搜索，如商品搜索，后台考虑选关系型，前台考虑选倒排索引；5）事务型系统，如库存，交易，记账，考虑选关系型+缓存+一致性型协议；6）离线计算，如大量数据分析，考虑选列式或者关系型也可以；7）实时计算，如实时监控，可以考虑选内存型或者列式数据库。

在设计实践中，我们要基于需求、业务驱动架构，无论选用 RDB/NoSQL/DRDB，一定是以需求为导向，最终数据存储方案必然是各种权衡的综合性设计。